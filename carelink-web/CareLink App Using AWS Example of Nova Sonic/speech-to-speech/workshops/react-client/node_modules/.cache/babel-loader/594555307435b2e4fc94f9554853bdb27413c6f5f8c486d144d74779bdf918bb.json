{"ast":null,"code":"var _jsxFileName = \"/Users/jonathanfox/Desktop/amazon-nova-samples/speech-to-speech/workshops/react-client/src/s2s.js\";\nimport React, { createRef } from 'react';\nimport './s2s.css';\nimport { Icon, Alert, Button, Modal, Box, SpaceBetween, Container, ColumnLayout, Header, FormField, Select, Textarea, Checkbox, ExpandableSection } from '@cloudscape-design/components';\nimport S2sEvent from './helper/s2sEvents';\nimport { base64LPCM } from './helper/audioHelper';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nclass S2sChatBot extends React.Component {\n  constructor(props) {\n    super(props);\n    this.handleSessionChange = e => {\n      let customPrompt = localStorage.getItem('carelink_summary');\n      const DEFAULT_PROMPT = S2sEvent.DEFAULT_SYSTEM_PROMPT;\n      if (customPrompt && typeof customPrompt === 'string') {\n        customPrompt = customPrompt.trim(); // No length limit\n      }\n      if (!customPrompt) {\n        customPrompt = DEFAULT_PROMPT;\n      }\n\n      // Get all vitals history\n      let vitalsHistory = [];\n      try {\n        vitalsHistory = JSON.parse(localStorage.getItem('carelink_vitals') || '[]');\n      } catch (e) {\n        vitalsHistory = [];\n      }\n      // Format as markdown table with explicit instruction\n      let vitalsString = '';\n      if (vitalsHistory.length > 0) {\n        vitalsString = \"\\n\\nHere is the patient's vitals history as a table:\\n\" + '| Time | Heart Rate | Blood Oxygen | Temperature |\\n' + '|------|------------|--------------|-------------|\\n' + vitalsHistory.map(v => `| ${new Date(v.timestamp).toLocaleString()} | ${v.heart_rate} | ${v.blood_oxygen} | ${v.temperature} |`).join('\\n') + '\\n\\nIf you are asked for a value at a specific time, look it up in the table above and answer precisely.';\n      }\n\n      // Combine summary and vitals (no length limit)\n      const fullPrompt = customPrompt + vitalsString;\n      if (this.state.sessionStarted) {\n        this.endSession();\n        this.cancelAudio();\n        this.setState({\n          sessionStarted: false\n        });\n      } else {\n        this.setState({\n          configSystemPrompt: fullPrompt,\n          chatMessages: [],\n          events: [],\n          eventsByContentName: []\n        }, () => {\n          this.startSession();\n          this.setState({\n            sessionStarted: true\n          });\n        });\n      }\n    };\n    this.state = {\n      status: \"loading\",\n      // null, loading, loaded\n      alert: null,\n      sessionStarted: false,\n      showEventJson: false,\n      showConfig: false,\n      selectedEvent: null,\n      chatMessages: {},\n      events: [],\n      audioResponse: [],\n      eventsByContentName: [],\n      audioChunks: [],\n      audioInputIndex: 0,\n      audioPlayPromise: null,\n      includeChatHistory: false,\n      // S2S config items\n      configAudioInput: null,\n      configSystemPrompt: S2sEvent.DEFAULT_SYSTEM_PROMPT,\n      configAudioOutput: S2sEvent.DEFAULT_AUDIO_OUTPUT_CONFIG,\n      configVoiceIdOption: {\n        label: \"Matthew (en-US)\",\n        value: \"matthew\"\n      },\n      configToolUse: JSON.stringify(S2sEvent.DEFAULT_TOOL_CONFIG, null, 2),\n      configChatHistory: JSON.stringify(S2sEvent.DEFAULT_CHAT_HISTORY, null, 2)\n    };\n    this.socket = null;\n    this.mediaRecorder = null;\n    //this.audioQueue = new AudioQueue();\n    this.chatMessagesEndRef = /*#__PURE__*/React.createRef();\n    this.audioPlayerRef = /*#__PURE__*/createRef();\n    this.audioQueue = [];\n    this.promptName = null;\n    this.textContentName = null;\n    this.audioContentName = null;\n  }\n  componentDidMount() {\n    //this.connectWebSocket();\n  }\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.chatMessages.length !== this.state.chatMessages.length) {\n      var _this$chatMessagesEnd;\n      (_this$chatMessagesEnd = this.chatMessagesEndRef.current) === null || _this$chatMessagesEnd === void 0 ? void 0 : _this$chatMessagesEnd.scrollIntoView({\n        behavior: 'smooth'\n      });\n    }\n  }\n  sendEvent(event) {\n    if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n      this.socket.send(JSON.stringify(event));\n      event.timestamp = Date.now();\n      this.displayEvent(event, \"out\");\n    }\n  }\n  cancelAudio() {\n    try {\n      if (this.audioPlayerRef.current && this.state.audioPlayPromise) {\n        this.audioPlayerRef.current.pause();\n        this.audioPlayerRef.current.currentTime = 0;\n        //this.audioPlayerRef.current.removeAttribute('src');\n        this.setState({\n          audioPlayPromise: null\n        });\n      }\n      this.audioQueue = [];\n      this.setState({\n        isPlaying: false\n      });\n    } catch (err) {\n      console.log(err);\n    }\n  }\n  audioEnqueue(audioUrl) {\n    this.audioQueue.push(audioUrl);\n    if (!this.state.isPlaying) {\n      this.playNext();\n    }\n  }\n  playNext() {\n    try {\n      if (this.isPlaying || this.audioQueue.length === 0) return;\n      if (this.audioPlayerRef.current && this.audioQueue.length > 0) {\n        let audioUrl = this.audioQueue.shift();\n        this.setState({\n          isPlaying: true\n        });\n        try {\n          this.audioPlayerRef.current.src = audioUrl;\n          this.audioPlayerRef.current.load(); // Reload the audio element to apply the new src\n          this.setState({\n            audioPlayPromise: this.audioPlayerRef.current.play().catch(err => {})\n          });\n        } catch (err) {\n          console.log(err);\n        }\n\n        // Wait for the audio to finish, then play the next one\n        this.audioPlayerRef.current.onended = () => {\n          this.setState({\n            isPlaying: false\n          });\n          this.playNext();\n        };\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  handleIncomingMessage(message) {\n    const eventType = Object.keys(message === null || message === void 0 ? void 0 : message.event)[0];\n    const role = message.event[eventType][\"role\"];\n    const content = message.event[eventType][\"content\"];\n    const contentId = message.event[eventType].contentId;\n    let stopReason = message.event[eventType].stopReason;\n    const contentType = message.event[eventType].type;\n    var chatMessages = this.state.chatMessages;\n    var audioResponse = this.state.audioResponse;\n    switch (eventType) {\n      case \"textOutput\":\n        // Detect interruption\n        if (role === \"ASSISTANT\" && content.startsWith(\"{\")) {\n          const evt = JSON.parse(content);\n          if (evt.interrupted === true) {\n            this.cancelAudio();\n          }\n        }\n        if (chatMessages.hasOwnProperty(contentId)) {\n          chatMessages[contentId].content = content;\n          chatMessages[contentId].role = role;\n          if (chatMessages[contentId].raw === undefined) chatMessages[contentId].raw = [];\n          chatMessages[contentId].raw.push(message);\n        }\n        this.setState({\n          chatMessages: chatMessages\n        });\n        break;\n      case \"audioOutput\":\n        audioResponse[contentId] += message.event[eventType].content;\n        this.setState({\n          audioResponse: audioResponse\n        });\n        //this.state.audioResponse[contentId] += message.event[eventType].content;\n        break;\n      case \"contentStart\":\n        if (contentType === \"AUDIO\") {\n          audioResponse[contentId] = \"\";\n          this.setState({\n            audioResponse: audioResponse\n          });\n        } else if (contentType === \"TEXT\") {\n          var generationStage = \"\";\n          if (message.event.contentStart.additionalModelFields) {\n            var _JSON$parse;\n            generationStage = (_JSON$parse = JSON.parse(message.event.contentStart.additionalModelFields)) === null || _JSON$parse === void 0 ? void 0 : _JSON$parse.generationStage;\n          }\n          chatMessages[contentId] = {\n            \"content\": \"\",\n            \"role\": role,\n            \"generationStage\": generationStage,\n            \"raw\": []\n          };\n          chatMessages[contentId].raw.push(message);\n          this.setState({\n            chatMessages: chatMessages\n          });\n        }\n        break;\n      case \"contentEnd\":\n        if (contentType === \"AUDIO\") {\n          var audioUrl = base64LPCM(this.state.audioResponse[contentId]);\n          this.audioEnqueue(audioUrl);\n          //this.audioQueue.enqueue(audioUrl);\n        } else if (contentType === \"TEXT\") {\n          if (chatMessages.hasOwnProperty(contentId)) {\n            if (chatMessages[contentId].raw === undefined) chatMessages[contentId].raw = [];\n            chatMessages[contentId].raw.push(message);\n            chatMessages[contentId].stopReason = stopReason;\n          }\n          this.setState({\n            chatMessages: chatMessages\n          });\n        }\n        break;\n      default:\n        break;\n    }\n    this.displayEvent(message, \"in\");\n  }\n  displayEvent(event, type) {\n    if (event && event.event) {\n      const eventName = Object.keys(event === null || event === void 0 ? void 0 : event.event)[0];\n      let key = null;\n      let ts = Date.now();\n      let interrupted = false;\n      const contentType = event.event[eventName].type;\n      const contentName = event.event[eventName].contentName;\n      const contentId = event.event[eventName].contentId;\n      if (eventName === \"audioOutput\") {\n        key = `${eventName}-${contentId}`;\n        // truncate event audio content\n        event.event.audioOutput.content = event.event.audioOutput.content.substr(0, 10);\n      } else if (eventName === \"audioInput\") {\n        key = `${eventName}-${contentName}-${this.state.audioInputIndex}`;\n      } else if (eventName === \"contentStart\" || eventName === \"textInput\" || eventName === \"contentEnd\") {\n        key = `${eventName}}-${contentName}-${contentType}`;\n        if (type === \"in\" && event.event[eventName].type === \"AUDIO\") {\n          this.setState({\n            audioInputIndex: this.state.audioInputIndex + 1\n          });\n        } else if (type === \"out\") {\n          key = `${eventName}-${contentName}-${contentType}-${ts}`;\n        }\n      } else if (eventName === \"textOutput\") {\n        const role = event.event[eventName].role;\n        const content = event.event[eventName].content;\n        if (role === \"ASSISTANT\" && content.startsWith(\"{\")) {\n          const evt = JSON.parse(content);\n          interrupted = evt.interrupted === true;\n        }\n        key = `${eventName}-${ts}`;\n      } else {\n        key = `${eventName}-${ts}`;\n      }\n      let eventsByContentName = this.state.eventsByContentName;\n      if (eventsByContentName === null) eventsByContentName = [];\n      let exists = false;\n      for (var i = 0; i < eventsByContentName.length; i++) {\n        var item = eventsByContentName[i];\n        if (item.key === key && item.type === type) {\n          item.events.push(event);\n          item.interrupted = interrupted;\n          exists = true;\n          break;\n        }\n      }\n      if (!exists) {\n        const item = {\n          key: key,\n          name: eventName,\n          type: type,\n          events: [event],\n          ts: ts\n        };\n        eventsByContentName.unshift(item);\n      }\n      this.setState({\n        eventsByContentName: eventsByContentName\n      });\n    }\n  }\n  connectWebSocket() {\n    // Connect to the S2S WebSocket server\n    if (this.socket === null || this.socket.readyState !== WebSocket.OPEN) {\n      this.socket = new WebSocket(process.env.REACT_APP_WEBSOCKET_URL);\n      this.socket.onopen = () => {\n        console.log(\"WebSocket connected!\");\n        this.promptName = crypto.randomUUID();\n        this.textContentName = crypto.randomUUID();\n        this.audioContentName = crypto.randomUUID();\n\n        // Start session events\n        this.sendEvent(S2sEvent.sessionStart());\n        var audioConfig = S2sEvent.DEFAULT_AUDIO_OUTPUT_CONFIG;\n        audioConfig.voiceId = this.state.configVoiceIdOption.value;\n        var toolConfig = this.state.configToolUse ? JSON.parse(this.state.configToolUse) : S2sEvent.DEFAULT_TOOL_CONFIG;\n        this.sendEvent(S2sEvent.promptStart(this.promptName, audioConfig, toolConfig));\n        this.sendEvent(S2sEvent.contentStartText(this.promptName, this.textContentName));\n        this.sendEvent(S2sEvent.textInput(this.promptName, this.textContentName, this.state.configSystemPrompt));\n        this.sendEvent(S2sEvent.contentEnd(this.promptName, this.textContentName));\n\n        // Chat history\n        if (this.state.includeChatHistory) {\n          var chatHistory = JSON.parse(this.state.configChatHistory);\n          if (chatHistory === null) chatHistory = S2sEvent.DEFAULT_CHAT_HISTORY;\n          for (const chat of chatHistory) {\n            const chatHistoryContentName = crypto.randomUUID();\n            this.sendEvent(S2sEvent.contentStartText(this.promptName, chatHistoryContentName, chat.role));\n            this.sendEvent(S2sEvent.textInput(this.promptName, chatHistoryContentName, chat.content));\n            this.sendEvent(S2sEvent.contentEnd(this.promptName, chatHistoryContentName));\n          }\n        }\n        this.sendEvent(S2sEvent.contentStartAudio(this.promptName, this.audioContentName));\n      };\n\n      // Handle incoming messages\n      this.socket.onmessage = message => {\n        const event = JSON.parse(message.data);\n        this.handleIncomingMessage(event);\n      };\n\n      // Handle errors\n      this.socket.onerror = error => {\n        this.setState({\n          alert: \"WebSocket Error: \",\n          error\n        });\n        console.error(\"WebSocket Error: \", error);\n      };\n\n      // Handle connection close\n      this.socket.onclose = () => {\n        console.log(\"WebSocket Disconnected\");\n        if (this.state.sessionStarted) this.setState({\n          alert: \"WebSocket Disconnected\"\n        });\n      };\n    }\n  }\n  startSession() {\n    // Init S2sSessionManager\n    try {\n      if (this.socket === null || this.socket.readyState !== WebSocket.OPEN) {\n        this.connectWebSocket();\n      }\n\n      // Start microphone \n      this.startMicrophone();\n    } catch (error) {\n      console.error('Error accessing microphone: ', error);\n    }\n  }\n  async startMicrophone() {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true\n        }\n      });\n      const audioContext = new (window.AudioContext || window.webkitAudioContext)({\n        latencyHint: 'interactive'\n      });\n      const source = audioContext.createMediaStreamSource(stream);\n      const processor = audioContext.createScriptProcessor(512, 1, 1);\n      source.connect(processor);\n      processor.connect(audioContext.destination);\n      const targetSampleRate = 16000;\n      processor.onaudioprocess = async e => {\n        if (this.state.sessionStarted) {\n          const inputBuffer = e.inputBuffer;\n\n          // Create an offline context for resampling\n          const offlineContext = new OfflineAudioContext({\n            numberOfChannels: 1,\n            length: Math.ceil(inputBuffer.duration * targetSampleRate),\n            sampleRate: targetSampleRate\n          });\n\n          // Copy input to offline context buffer\n          const offlineSource = offlineContext.createBufferSource();\n          const monoBuffer = offlineContext.createBuffer(1, inputBuffer.length, inputBuffer.sampleRate);\n          monoBuffer.copyToChannel(inputBuffer.getChannelData(0), 0);\n          offlineSource.buffer = monoBuffer;\n          offlineSource.connect(offlineContext.destination);\n          offlineSource.start(0);\n\n          // Resample and get the rendered buffer\n          const renderedBuffer = await offlineContext.startRendering();\n          const resampled = renderedBuffer.getChannelData(0);\n\n          // Convert to Int16 PCM\n          const buffer = new ArrayBuffer(resampled.length * 2);\n          const pcmData = new DataView(buffer);\n          for (let i = 0; i < resampled.length; i++) {\n            const s = Math.max(-1, Math.min(1, resampled[i]));\n            pcmData.setInt16(i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n          }\n\n          // Convert to binary string and base64 encode\n          let binary = '';\n          for (let i = 0; i < pcmData.byteLength; i++) {\n            binary += String.fromCharCode(pcmData.getUint8(i));\n          }\n          const event = S2sEvent.audioInput(this.promptName, this.audioContentName, btoa(binary));\n          this.sendEvent(event);\n        }\n      };\n      window.audioCleanup = () => {\n        processor.disconnect();\n        source.disconnect();\n        stream.getTracks().forEach(track => track.stop());\n      };\n      this.mediaRecorder = new MediaRecorder(stream);\n      this.mediaRecorder.ondataavailable = event => {\n        this.state.audioChunks.push(event.data);\n      };\n      this.mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(this.state.audioChunks, {\n          type: 'audio/webm'\n        });\n        this.sendEvent(S2sEvent.audioInput(this.promptName, this.audioContentName, btoa(audioBlob)));\n        this.setState({\n          audioChunks: []\n        });\n      };\n      this.mediaRecorder.start();\n      this.setState({\n        sessionStarted: true\n      });\n      console.log('Microphone recording started');\n    } catch (error) {\n      console.error('Error accessing microphone: ', error);\n    }\n  }\n  endSession() {\n    if (this.socket) {\n      // Close microphone\n      if (this.mediaRecorder && this.state.sessionStarted) {\n        this.mediaRecorder.stop();\n        console.log('Microphone recording stopped');\n      }\n\n      // Close S2sSessionManager\n      this.sendEvent(S2sEvent.contentEnd(this.promptName, this.audioContentName));\n      this.sendEvent(S2sEvent.promptEnd(this.promptName));\n      this.sendEvent(S2sEvent.sessionEnd());\n\n      // Close websocket\n      this.socket.close();\n      this.setState({\n        sessionStarted: false\n      });\n    }\n  }\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"s2s\",\n      children: [this.state.alert !== null && this.state.alert.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(Alert, {\n          statusIconAriaLabel: \"Warning\",\n          type: \"warning\",\n          children: this.state.alert\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 22\n        }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 17\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 518,\n        columnNumber: 37\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"top\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"action\",\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"primary\",\n            onClick: this.handleSessionChange,\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              name: this.state.sessionStarted ? \"microphone-off\" : \"microphone\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 29\n            }, this), \"\\xA0\\xA0\", this.state.sessionStarted ? \"End Conversation\" : \"Start Conversation\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 521,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chathistory\",\n            children: [/*#__PURE__*/_jsxDEV(Checkbox, {\n              checked: this.state.includeChatHistory,\n              onChange: ({\n                detail\n              }) => this.setState({\n                includeChatHistory: detail.checked\n              }),\n              children: \"Include chat history\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 526,\n              columnNumber: 29\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"desc\",\n              children: \"You can view sample chat history in the settings.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 527,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 525,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n            ref: this.audioPlayerRef\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 529,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 520,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"setting\",\n          children: /*#__PURE__*/_jsxDEV(Button, {\n            onClick: () => this.setState({\n              showConfig: true\n            }),\n            children: /*#__PURE__*/_jsxDEV(Icon, {\n              name: \"settings\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 537,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 532,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 531,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 519,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 542,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ColumnLayout, {\n        columns: 2,\n        children: [/*#__PURE__*/_jsxDEV(Container, {\n          header: /*#__PURE__*/_jsxDEV(Header, {\n            variant: \"h2\",\n            children: \"Conversation\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 545,\n            columnNumber: 25\n          }, this),\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"chatarea\",\n            children: [Object.keys(this.state.chatMessages).map((key, index) => {\n              const msg = this.state.chatMessages[key];\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"item\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: msg.role === \"USER\" ? \"user\" : \"bot\",\n                  onClick: () => this.setState({\n                    showEventJson: true,\n                    selectedEvent: {\n                      events: msg.raw\n                    }\n                  }),\n                  children: [/*#__PURE__*/_jsxDEV(Icon, {\n                    name: msg.role === \"USER\" ? \"user-profile\" : \"gen-ai\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 557,\n                    columnNumber: 37\n                  }, this), \"\\xA0\\xA0\", msg.content, msg.role === \"ASSISTANT\" && msg.generationStage ? ` [${msg.generationStage}]` : \"\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 551,\n                  columnNumber: 33\n                }, this)\n              }, key, false, {\n                fileName: _jsxFileName,\n                lineNumber: 550,\n                columnNumber: 36\n              }, this);\n            }), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"endbar\",\n              ref: this.chatMessagesEndRef\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 563,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 547,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Container, {\n          header: /*#__PURE__*/_jsxDEV(Header, {\n            variant: \"h2\",\n            children: \"Events\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 567,\n            columnNumber: 25\n          }, this),\n          children: /*#__PURE__*/_jsxDEV(ExpandableSection, {\n            headerText: \"Show Events (for debugging)\",\n            defaultExpanded: false,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"events\",\n              children: [this.state.eventsByContentName.map(event => {\n                return /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: event.name === \"toolUse\" ? \"event-tool\" : event.interrupted === true ? \"event-int\" : event.type === \"in\" ? \"event-in\" : \"event-out\",\n                  onClick: () => {\n                    this.setState({\n                      selectedEvent: event,\n                      showEventJson: true\n                    });\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Icon, {\n                    name: event.type === \"in\" ? \"arrow-down\" : \"arrow-up\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 582,\n                    columnNumber: 33\n                  }, this), \"\\xA0\\xA0\", event.name, event.events.length > 1 ? ` (${event.events.length})` : \"\", /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"tooltip\",\n                    children: /*#__PURE__*/_jsxDEV(\"pre\", {\n                      id: \"jsonDisplay\",\n                      children: event.events.map(e => {\n                        return JSON.stringify(e, null, 2);\n                      })\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 586,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 585,\n                    columnNumber: 33\n                  }, this)]\n                }, event.key, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 572,\n                  columnNumber: 36\n                }, this);\n              }), /*#__PURE__*/_jsxDEV(Modal, {\n                onDismiss: () => this.setState({\n                  showEventJson: false\n                }),\n                visible: this.state.showEventJson,\n                header: \"Event details\",\n                size: \"medium\",\n                footer: /*#__PURE__*/_jsxDEV(Box, {\n                  float: \"right\",\n                  children: /*#__PURE__*/_jsxDEV(SpaceBetween, {\n                    direction: \"horizontal\",\n                    size: \"xs\",\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      variant: \"link\",\n                      onClick: () => this.setState({\n                        showEventJson: false\n                      }),\n                      children: \"Close\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 601,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 600,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 599,\n                  columnNumber: 33\n                }, this),\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"eventdetail\",\n                  children: /*#__PURE__*/_jsxDEV(\"pre\", {\n                    id: \"jsonDisplay\",\n                    children: this.state.selectedEvent && this.state.selectedEvent.events.map(e => {\n                      const eventType = Object.keys(e === null || e === void 0 ? void 0 : e.event)[0];\n                      if (eventType === \"audioInput\" || eventType === \"audioOutput\") e.event[eventType].content = e.event[eventType].content.substr(0, 10) + \"...\";\n                      const ts = new Date(e.timestamp).toLocaleString(undefined, {\n                        year: \"numeric\",\n                        month: \"2-digit\",\n                        day: \"2-digit\",\n                        hour: \"2-digit\",\n                        minute: \"2-digit\",\n                        second: \"2-digit\",\n                        fractionalSecondDigits: 3,\n                        // Show milliseconds\n                        hour12: false // 24-hour format\n                      });\n                      var displayJson = {\n                        ...e\n                      };\n                      delete displayJson.timestamp;\n                      return ts + \"\\n\" + JSON.stringify(displayJson, null, 2) + \"\\n\";\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 607,\n                    columnNumber: 29\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 606,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 593,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(Modal, {\n                onDismiss: () => this.setState({\n                  showConfig: false\n                }),\n                visible: this.state.showConfig,\n                header: \"Nova S2S settings\",\n                size: \"large\",\n                footer: /*#__PURE__*/_jsxDEV(Box, {\n                  float: \"right\",\n                  children: /*#__PURE__*/_jsxDEV(SpaceBetween, {\n                    direction: \"horizontal\",\n                    size: \"xs\",\n                    children: /*#__PURE__*/_jsxDEV(Button, {\n                      variant: \"link\",\n                      onClick: () => this.setState({\n                        showConfig: false\n                      }),\n                      children: \"Save\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 637,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 636,\n                    columnNumber: 33\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 635,\n                  columnNumber: 33\n                }, this),\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"config\",\n                  children: [/*#__PURE__*/_jsxDEV(FormField, {\n                    label: \"Voice Id\",\n                    stretch: true,\n                    children: /*#__PURE__*/_jsxDEV(Select, {\n                      selectedOption: this.state.configVoiceIdOption,\n                      onChange: ({\n                        detail\n                      }) => this.setState({\n                        configVoiceIdOption: detail.selectedOption\n                      }),\n                      options: [{\n                        label: \"Matthew (en-US)\",\n                        value: \"matthew\"\n                      }, {\n                        label: \"Tiffany (en-US)\",\n                        value: \"tiffany\"\n                      }, {\n                        label: \"Amy (en-GB)\",\n                        value: \"amy\"\n                      }]\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 647,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 643,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 659,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(FormField, {\n                    label: \"System prompt\",\n                    description: \"For the speech model\",\n                    stretch: true,\n                    children: /*#__PURE__*/_jsxDEV(Textarea, {\n                      onChange: ({\n                        detail\n                      }) => this.setState({\n                        configSystemPrompt: detail.value\n                      }),\n                      value: this.state.configSystemPrompt,\n                      placeholder: \"Speech system prompt\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 665,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 660,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 671,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(FormField, {\n                    label: \"Tool use configuration\",\n                    description: \"For external integration such as RAG and Agents\",\n                    stretch: true,\n                    children: /*#__PURE__*/_jsxDEV(Textarea, {\n                      onChange: ({\n                        detail\n                      }) => this.setState({\n                        configToolUse: detail.value\n                      }),\n                      value: this.state.configToolUse,\n                      rows: 10,\n                      placeholder: \"{}\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 677,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 672,\n                    columnNumber: 33\n                  }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 684,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(FormField, {\n                    label: \"Chat history\",\n                    description: \"Sample chat history to resume conversation\",\n                    stretch: true,\n                    children: /*#__PURE__*/_jsxDEV(Textarea, {\n                      onChange: ({\n                        detail\n                      }) => this.setState({\n                        configChatHistory: detail.value\n                      }),\n                      value: this.state.configChatHistory,\n                      rows: 15,\n                      placeholder: \"{}\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 690,\n                      columnNumber: 37\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 685,\n                    columnNumber: 33\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 642,\n                  columnNumber: 29\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 629,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 570,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 569,\n            columnNumber: 21\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 566,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 543,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 514,\n      columnNumber: 13\n    }, this);\n  }\n}\nexport default S2sChatBot;","map":{"version":3,"names":["React","createRef","Icon","Alert","Button","Modal","Box","SpaceBetween","Container","ColumnLayout","Header","FormField","Select","Textarea","Checkbox","ExpandableSection","S2sEvent","base64LPCM","jsxDEV","_jsxDEV","S2sChatBot","Component","constructor","props","handleSessionChange","e","customPrompt","localStorage","getItem","DEFAULT_PROMPT","DEFAULT_SYSTEM_PROMPT","trim","vitalsHistory","JSON","parse","vitalsString","length","map","v","Date","timestamp","toLocaleString","heart_rate","blood_oxygen","temperature","join","fullPrompt","state","sessionStarted","endSession","cancelAudio","setState","configSystemPrompt","chatMessages","events","eventsByContentName","startSession","status","alert","showEventJson","showConfig","selectedEvent","audioResponse","audioChunks","audioInputIndex","audioPlayPromise","includeChatHistory","configAudioInput","configAudioOutput","DEFAULT_AUDIO_OUTPUT_CONFIG","configVoiceIdOption","label","value","configToolUse","stringify","DEFAULT_TOOL_CONFIG","configChatHistory","DEFAULT_CHAT_HISTORY","socket","mediaRecorder","chatMessagesEndRef","audioPlayerRef","audioQueue","promptName","textContentName","audioContentName","componentDidMount","componentDidUpdate","prevProps","prevState","_this$chatMessagesEnd","current","scrollIntoView","behavior","sendEvent","event","readyState","WebSocket","OPEN","send","now","displayEvent","pause","currentTime","isPlaying","err","console","log","audioEnqueue","audioUrl","push","playNext","shift","src","load","play","catch","onended","error","handleIncomingMessage","message","eventType","Object","keys","role","content","contentId","stopReason","contentType","type","startsWith","evt","interrupted","hasOwnProperty","raw","undefined","generationStage","contentStart","additionalModelFields","_JSON$parse","eventName","key","ts","contentName","audioOutput","substr","exists","i","item","name","unshift","connectWebSocket","process","env","REACT_APP_WEBSOCKET_URL","onopen","crypto","randomUUID","sessionStart","audioConfig","voiceId","toolConfig","promptStart","contentStartText","textInput","contentEnd","chatHistory","chat","chatHistoryContentName","contentStartAudio","onmessage","data","onerror","onclose","startMicrophone","stream","navigator","mediaDevices","getUserMedia","audio","echoCancellation","noiseSuppression","autoGainControl","audioContext","window","AudioContext","webkitAudioContext","latencyHint","source","createMediaStreamSource","processor","createScriptProcessor","connect","destination","targetSampleRate","onaudioprocess","inputBuffer","offlineContext","OfflineAudioContext","numberOfChannels","Math","ceil","duration","sampleRate","offlineSource","createBufferSource","monoBuffer","createBuffer","copyToChannel","getChannelData","buffer","start","renderedBuffer","startRendering","resampled","ArrayBuffer","pcmData","DataView","s","max","min","setInt16","binary","byteLength","String","fromCharCode","getUint8","audioInput","btoa","audioCleanup","disconnect","getTracks","forEach","track","stop","MediaRecorder","ondataavailable","onstop","audioBlob","Blob","promptEnd","sessionEnd","close","render","className","children","statusIconAriaLabel","fileName","_jsxFileName","lineNumber","columnNumber","variant","onClick","checked","onChange","detail","ref","columns","header","index","msg","headerText","defaultExpanded","id","onDismiss","visible","size","footer","float","direction","year","month","day","hour","minute","second","fractionalSecondDigits","hour12","displayJson","stretch","selectedOption","options","description","placeholder","rows"],"sources":["/Users/jonathanfox/Desktop/amazon-nova-samples/speech-to-speech/workshops/react-client/src/s2s.js"],"sourcesContent":["import React, { createRef } from 'react';\nimport './s2s.css'\nimport { Icon, Alert, Button, Modal, Box, SpaceBetween, Container, ColumnLayout, Header, FormField, Select, Textarea, Checkbox, ExpandableSection } from '@cloudscape-design/components';\nimport S2sEvent from './helper/s2sEvents';\nimport {base64LPCM} from './helper/audioHelper';\n\nclass S2sChatBot extends React.Component {\n\n    constructor(props) {\n        super(props);\n        this.state = {\n            status: \"loading\", // null, loading, loaded\n            alert: null,\n            sessionStarted: false,\n            showEventJson: false,\n            showConfig: false,\n            selectedEvent: null,\n\n            chatMessages: {},\n            events: [],\n            audioResponse: [],\n            eventsByContentName: [],\n            audioChunks: [],\n            audioInputIndex: 0,\n            audioPlayPromise: null,\n            includeChatHistory: false,\n\n            // S2S config items\n            configAudioInput: null,\n            configSystemPrompt: S2sEvent.DEFAULT_SYSTEM_PROMPT,\n            configAudioOutput: S2sEvent.DEFAULT_AUDIO_OUTPUT_CONFIG,\n            configVoiceIdOption: { label: \"Matthew (en-US)\", value: \"matthew\" },\n            configToolUse: JSON.stringify(S2sEvent.DEFAULT_TOOL_CONFIG, null, 2),\n            configChatHistory: JSON.stringify(S2sEvent.DEFAULT_CHAT_HISTORY, null, 2),\n        };\n        this.socket = null;\n        this.mediaRecorder = null;\n        //this.audioQueue = new AudioQueue();\n        this.chatMessagesEndRef = React.createRef();\n        this.audioPlayerRef = createRef();\n        this.audioQueue = [];\n\n        this.promptName = null;\n        this.textContentName = null;\n        this.audioContentName = null;\n    }\n\n    componentDidMount() {\n        //this.connectWebSocket();\n    }\n\n    componentDidUpdate(prevProps, prevState) {\n        if (prevState.chatMessages.length !== this.state.chatMessages.length) {\n            this.chatMessagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n        }\n    }\n    \n    sendEvent(event) {\n        if (this.socket && this.socket.readyState === WebSocket.OPEN) {\n            this.socket.send(JSON.stringify(event));\n            event.timestamp = Date.now();\n            this.displayEvent(event, \"out\");\n        }\n    }\n    \n    cancelAudio() {\n        try {\n            if (this.audioPlayerRef.current && this.state.audioPlayPromise) {\n                this.audioPlayerRef.current.pause();\n                this.audioPlayerRef.current.currentTime = 0;\n                //this.audioPlayerRef.current.removeAttribute('src');\n                this.setState({audioPlayPromise: null});\n              }\n              this.audioQueue = []\n              this.setState({\n                isPlaying: false,\n              });\n        }\n        catch(err) {\n            console.log(err);\n        }\n    }\n\n    audioEnqueue(audioUrl) {\n        this.audioQueue.push(audioUrl);\n        if (!this.state.isPlaying) {\n            this.playNext();\n        }\n    }\n\n    playNext() {\n        try{\n            if (this.isPlaying || this.audioQueue.length === 0) return;\n        \n            if (this.audioPlayerRef.current && this.audioQueue.length > 0) {\n                let audioUrl  = this.audioQueue.shift();\n                this.setState({ isPlaying: true});\n\n                try {\n                    this.audioPlayerRef.current.src = audioUrl;\n                    this.audioPlayerRef.current.load();  // Reload the audio element to apply the new src\n                    this.setState({audioPlayPromise: this.audioPlayerRef.current.play().catch((err) => {})}); \n                }\n                catch(err) {\n                    console.log(err);\n                }\n                \n                // Wait for the audio to finish, then play the next one\n                this.audioPlayerRef.current.onended = () => {\n                    this.setState({ isPlaying: false});\n                    this.playNext();\n                };\n            }\n        }\n        catch (error) {\n            console.log(error);\n        }\n    }\n    handleIncomingMessage (message) {\n        const eventType = Object.keys(message?.event)[0];\n        const role = message.event[eventType][\"role\"];\n        const content = message.event[eventType][\"content\"];\n        const contentId = message.event[eventType].contentId;\n        let stopReason = message.event[eventType].stopReason;\n        const contentType = message.event[eventType].type;\n        var chatMessages = this.state.chatMessages;\n        var audioResponse = this.state.audioResponse;\n\n        switch(eventType) {\n            case \"textOutput\": \n                // Detect interruption\n                if (role === \"ASSISTANT\" && content.startsWith(\"{\")) {\n                    const evt = JSON.parse(content);\n                    if (evt.interrupted === true) {\n                        this.cancelAudio()\n                    }\n                }\n\n                if (chatMessages.hasOwnProperty(contentId)) {\n                    chatMessages[contentId].content = content;\n                    chatMessages[contentId].role = role;\n                    if (chatMessages[contentId].raw === undefined)\n                        chatMessages[contentId].raw = [];\n                    chatMessages[contentId].raw.push(message);\n                }\n                this.setState({chatMessages: chatMessages});\n                break;\n            case \"audioOutput\":\n                audioResponse[contentId] += message.event[eventType].content;\n                this.setState({audioResponse: audioResponse});\n                //this.state.audioResponse[contentId] += message.event[eventType].content;\n                break;\n            case \"contentStart\":\n                if (contentType === \"AUDIO\") {\n                    audioResponse[contentId] = \"\";\n                    this.setState({audioResponse: audioResponse});\n                }\n                else if (contentType === \"TEXT\") {\n                    var generationStage = \"\";\n                    if (message.event.contentStart.additionalModelFields) {\n                        generationStage = JSON.parse(message.event.contentStart.additionalModelFields)?.generationStage;\n                    }\n\n                    chatMessages[contentId] =  {\n                        \"content\": \"\", \n                        \"role\": role,\n                        \"generationStage\": generationStage,\n                        \"raw\": [],\n                    };\n                    chatMessages[contentId].raw.push(message);\n                    this.setState({chatMessages: chatMessages});\n                }\n                break;\n            case \"contentEnd\":\n                if (contentType === \"AUDIO\") {\n                    var audioUrl = base64LPCM(this.state.audioResponse[contentId]);\n                    this.audioEnqueue(audioUrl);\n                    //this.audioQueue.enqueue(audioUrl);\n                }\n                else if (contentType === \"TEXT\"){\n                    if (chatMessages.hasOwnProperty(contentId)) {\n                        if (chatMessages[contentId].raw === undefined)\n                            chatMessages[contentId].raw = [];\n                        chatMessages[contentId].raw.push(message);\n                        chatMessages[contentId].stopReason = stopReason;\n                    }\n                    this.setState({chatMessages: chatMessages});\n\n                }\n                break;\n            default:\n                break;\n\n        }\n\n        this.displayEvent(message, \"in\");\n    }\n\n    displayEvent(event, type) {\n        if (event && event.event) {\n            const eventName = Object.keys(event?.event)[0];\n            let key = null;\n            let ts = Date.now();\n            let interrupted = false;\n            const contentType = event.event[eventName].type;\n            const contentName = event.event[eventName].contentName;\n            const contentId = event.event[eventName].contentId;\n\n            if (eventName === \"audioOutput\") {\n                key = `${eventName}-${contentId}`;\n                // truncate event audio content\n                event.event.audioOutput.content = event.event.audioOutput.content.substr(0,10);\n            }\n            else if (eventName === \"audioInput\") {\n                key = `${eventName}-${contentName}-${this.state.audioInputIndex}`;\n            }\n            else if (eventName === \"contentStart\" || eventName === \"textInput\" || eventName === \"contentEnd\") {\n                key = `${eventName}}-${contentName}-${contentType}`;\n                if (type === \"in\" && event.event[eventName].type === \"AUDIO\") {\n                    this.setState({audioInputIndex: this.state.audioInputIndex + 1});\n                }\n                else if(type === \"out\") {\n                    key = `${eventName}-${contentName}-${contentType}-${ts}`;\n                }\n            }\n            else if(eventName === \"textOutput\") {\n                const role = event.event[eventName].role;\n                const content = event.event[eventName].content;\n                if (role === \"ASSISTANT\" && content.startsWith(\"{\")) {\n                    const evt = JSON.parse(content);\n                    interrupted = evt.interrupted === true;\n                }\n                key = `${eventName}-${ts}`;\n            }\n            else {\n                key = `${eventName}-${ts}`;\n            }\n\n            let eventsByContentName = this.state.eventsByContentName;\n            if (eventsByContentName === null)\n                eventsByContentName = [];\n\n            let exists = false;\n            for(var i=0;i<eventsByContentName.length;i++) {\n                var item = eventsByContentName[i];\n                if (item.key === key && item.type === type) {\n                    item.events.push(event);\n\n                    item.interrupted = interrupted;\n                    exists = true;\n                    break;\n                }\n            }\n            if (!exists) {\n                const item = {\n                    key: key, \n                    name: eventName, \n                    type: type, \n                    events: [event], \n                    ts: ts,\n                };\n                eventsByContentName.unshift(item);\n            }\n            this.setState({eventsByContentName: eventsByContentName});\n        }\n    }\n\n    handleSessionChange = e => {\n        let customPrompt = localStorage.getItem('carelink_summary');\n        const DEFAULT_PROMPT = S2sEvent.DEFAULT_SYSTEM_PROMPT;\n        if (customPrompt && typeof customPrompt === 'string') {\n            customPrompt = customPrompt.trim(); // No length limit\n        }\n        if (!customPrompt) {\n            customPrompt = DEFAULT_PROMPT;\n        }\n\n        // Get all vitals history\n        let vitalsHistory = [];\n        try {\n            vitalsHistory = JSON.parse(localStorage.getItem('carelink_vitals') || '[]');\n        } catch (e) {\n            vitalsHistory = [];\n        }\n        // Format as markdown table with explicit instruction\n        let vitalsString = '';\n        if (vitalsHistory.length > 0) {\n            vitalsString = \"\\n\\nHere is the patient's vitals history as a table:\\n\" +\n                '| Time | Heart Rate | Blood Oxygen | Temperature |\\n' +\n                '|------|------------|--------------|-------------|\\n' +\n                vitalsHistory.map(v =>\n                    `| ${new Date(v.timestamp).toLocaleString()} | ${v.heart_rate} | ${v.blood_oxygen} | ${v.temperature} |`\n                ).join('\\n') +\n                '\\n\\nIf you are asked for a value at a specific time, look it up in the table above and answer precisely.';\n        }\n\n        // Combine summary and vitals (no length limit)\n        const fullPrompt = customPrompt + vitalsString;\n\n        if (this.state.sessionStarted) {\n            this.endSession();\n            this.cancelAudio();\n            this.setState({sessionStarted: false});\n        } else {\n            this.setState(\n                { configSystemPrompt: fullPrompt, chatMessages:[], events: [], eventsByContentName: [] },\n                () => {\n                    this.startSession();\n                    this.setState({sessionStarted: true});\n                }\n            );\n        }\n    }\n\n    connectWebSocket() {\n        // Connect to the S2S WebSocket server\n        if (this.socket === null || this.socket.readyState !== WebSocket.OPEN) {\n            this.socket = new WebSocket(process.env.REACT_APP_WEBSOCKET_URL);\n        \n            this.socket.onopen = () => {\n                console.log(\"WebSocket connected!\");\n                this.promptName = crypto.randomUUID();\n                this.textContentName = crypto.randomUUID();\n                this.audioContentName = crypto.randomUUID();        \n    \n                // Start session events\n                this.sendEvent(S2sEvent.sessionStart());\n\n                var audioConfig = S2sEvent.DEFAULT_AUDIO_OUTPUT_CONFIG;\n                audioConfig.voiceId = this.state.configVoiceIdOption.value;\n                var toolConfig = this.state.configToolUse?JSON.parse(this.state.configToolUse):S2sEvent.DEFAULT_TOOL_CONFIG;\n\n                this.sendEvent(S2sEvent.promptStart(this.promptName, audioConfig, toolConfig));\n\n                this.sendEvent(S2sEvent.contentStartText(this.promptName, this.textContentName));\n\n                this.sendEvent(S2sEvent.textInput(this.promptName, this.textContentName, this.state.configSystemPrompt));\n                this.sendEvent(S2sEvent.contentEnd(this.promptName, this.textContentName));\n\n                // Chat history\n                if (this.state.includeChatHistory) {\n                    var chatHistory = JSON.parse(this.state.configChatHistory);\n                    if (chatHistory === null) chatHistory = S2sEvent.DEFAULT_CHAT_HISTORY;\n                    for (const chat of chatHistory) {\n                        const chatHistoryContentName = crypto.randomUUID();\n                        this.sendEvent(S2sEvent.contentStartText(this.promptName, chatHistoryContentName, chat.role));\n                        this.sendEvent(S2sEvent.textInput(this.promptName, chatHistoryContentName, chat.content));\n                        this.sendEvent(S2sEvent.contentEnd(this.promptName, chatHistoryContentName));\n                    }\n                    \n                }\n\n                this.sendEvent(S2sEvent.contentStartAudio(this.promptName, this.audioContentName));\n              };\n\n            // Handle incoming messages\n            this.socket.onmessage = (message) => {\n                const event = JSON.parse(message.data);\n                this.handleIncomingMessage(event);\n            };\n        \n            // Handle errors\n            this.socket.onerror = (error) => {\n                this.setState({alert: \"WebSocket Error: \", error});\n                console.error(\"WebSocket Error: \", error);\n            };\n        \n            // Handle connection close\n            this.socket.onclose = () => {\n                console.log(\"WebSocket Disconnected\");\n                if (this.state.sessionStarted)\n                    this.setState({alert: \"WebSocket Disconnected\"});\n            };\n        }\n    }\n\n    startSession() {\n        // Init S2sSessionManager\n        try {\n            if (this.socket === null || this.socket.readyState !== WebSocket.OPEN) {\n                this.connectWebSocket();\n            }\n\n            // Start microphone \n            this.startMicrophone();\n\n        } catch (error) {\n            console.error('Error accessing microphone: ', error);\n        }\n    }\n      \n    async startMicrophone() {\n        try {\n            const stream = await navigator.mediaDevices.getUserMedia({\n                audio: {\n                    echoCancellation: true,\n                    noiseSuppression: true,\n                    autoGainControl: true\n                }\n            });\n    \n            const audioContext = new (window.AudioContext || window.webkitAudioContext)({\n                latencyHint: 'interactive'\n            });\n    \n            const source = audioContext.createMediaStreamSource(stream);\n            const processor = audioContext.createScriptProcessor(512, 1, 1);\n    \n            source.connect(processor);\n            processor.connect(audioContext.destination);\n    \n            const targetSampleRate = 16000;\n    \n            processor.onaudioprocess = async (e) => {\n                if (this.state.sessionStarted) {\n                    const inputBuffer = e.inputBuffer;\n    \n                    // Create an offline context for resampling\n                    const offlineContext = new OfflineAudioContext({\n                        numberOfChannels: 1,\n                        length: Math.ceil(inputBuffer.duration * targetSampleRate),\n                        sampleRate: targetSampleRate\n                    });\n    \n                    // Copy input to offline context buffer\n                    const offlineSource = offlineContext.createBufferSource();\n                    const monoBuffer = offlineContext.createBuffer(1, inputBuffer.length, inputBuffer.sampleRate);\n                    monoBuffer.copyToChannel(inputBuffer.getChannelData(0), 0);\n    \n                    offlineSource.buffer = monoBuffer;\n                    offlineSource.connect(offlineContext.destination);\n                    offlineSource.start(0);\n    \n                    // Resample and get the rendered buffer\n                    const renderedBuffer = await offlineContext.startRendering();\n                    const resampled = renderedBuffer.getChannelData(0);\n    \n                    // Convert to Int16 PCM\n                    const buffer = new ArrayBuffer(resampled.length * 2);\n                    const pcmData = new DataView(buffer);\n    \n                    for (let i = 0; i < resampled.length; i++) {\n                        const s = Math.max(-1, Math.min(1, resampled[i]));\n                        pcmData.setInt16(i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);\n                    }\n    \n                    // Convert to binary string and base64 encode\n                    let binary = '';\n                    for (let i = 0; i < pcmData.byteLength; i++) {\n                        binary += String.fromCharCode(pcmData.getUint8(i));\n                    }\n    \n                    const event = S2sEvent.audioInput(\n                        this.promptName,\n                        this.audioContentName,\n                        btoa(binary)\n                    );\n                    this.sendEvent(event);\n                }\n            };\n    \n            window.audioCleanup = () => {\n                processor.disconnect();\n                source.disconnect();\n                stream.getTracks().forEach(track => track.stop());\n            };\n    \n            this.mediaRecorder = new MediaRecorder(stream);\n            this.mediaRecorder.ondataavailable = (event) => {\n                this.state.audioChunks.push(event.data);\n            };\n            this.mediaRecorder.onstop = () => {\n                const audioBlob = new Blob(this.state.audioChunks, { type: 'audio/webm' });\n                this.sendEvent(S2sEvent.audioInput(this.promptName, this.audioContentName, btoa(audioBlob)));\n                this.setState({ audioChunks: [] });\n            };\n    \n            this.mediaRecorder.start();\n            this.setState({ sessionStarted: true });\n            console.log('Microphone recording started');\n    \n        } catch (error) {\n            console.error('Error accessing microphone: ', error);\n        }\n    }\n    \n    \n\n    endSession() {\n        if (this.socket) {\n            // Close microphone\n            if (this.mediaRecorder && this.state.sessionStarted) {\n                this.mediaRecorder.stop();\n                console.log('Microphone recording stopped');\n            }\n\n            // Close S2sSessionManager\n            this.sendEvent(S2sEvent.contentEnd(this.promptName, this.audioContentName));\n            this.sendEvent(S2sEvent.promptEnd(this.promptName));\n            this.sendEvent(S2sEvent.sessionEnd());\n\n            // Close websocket\n            this.socket.close();\n\n            this.setState({\n                sessionStarted: false,\n            });\n\n        }\n  \n    }\n    render() {\n        return (\n            <div className=\"s2s\">\n                {this.state.alert !== null && this.state.alert.length > 0?\n                <div><Alert statusIconAriaLabel=\"Warning\" type=\"warning\">\n                {this.state.alert}\n                </Alert><br/></div>:<div/>}\n                <div className='top'>\n                    <div className='action'>\n                        <Button variant='primary' onClick={this.handleSessionChange}>\n                            <Icon name={this.state.sessionStarted?\"microphone-off\":\"microphone\"} />&nbsp;&nbsp;\n                            {this.state.sessionStarted?\"End Conversation\":\"Start Conversation\"}\n                        </Button>\n                        <div className='chathistory'>\n                            <Checkbox checked={this.state.includeChatHistory} onChange={({ detail }) => this.setState({includeChatHistory: detail.checked})}>Include chat history</Checkbox>\n                            <div className='desc'>You can view sample chat history in the settings.</div>\n                        </div>\n                        <audio ref={this.audioPlayerRef}></audio>\n                    </div>\n                    <div className='setting'>\n                        <Button onClick={()=> \n                            this.setState({\n                                showConfig: true, \n                            })\n                        }>\n                            <Icon name=\"settings\"/>\n                        </Button>\n                        \n                    </div>\n                </div>\n                <br/>\n                <ColumnLayout columns={2}>\n                    <Container header={\n                        <Header variant=\"h2\">Conversation</Header>\n                    }>\n                    <div className=\"chatarea\">\n                        {Object.keys(this.state.chatMessages).map((key,index) => {\n                            const msg = this.state.chatMessages[key];\n                            return <div className='item' key={key}>\n                                <div className={msg.role === \"USER\"?\"user\":\"bot\"} onClick={()=> \n                                        this.setState({\n                                            showEventJson: true, \n                                            selectedEvent: {events:msg.raw}\n                                        })\n                                    }>\n                                    <Icon name={msg.role === \"USER\"?\"user-profile\":\"gen-ai\"} />&nbsp;&nbsp;\n                                    {msg.content}\n                                    {msg.role === \"ASSISTANT\" && msg.generationStage? ` [${msg.generationStage}]`:\"\"}\n                                </div>\n                            </div>\n                        })}\n                        <div className='endbar' ref={this.chatMessagesEndRef}></div>\n                    </div>\n                    </Container>\n                    <Container header={\n                        <Header variant=\"h2\">Events</Header>\n                    }>\n                    <ExpandableSection headerText=\"Show Events (for debugging)\" defaultExpanded={false}>\n                    <div className='events'>\n                        {this.state.eventsByContentName.map(event=>{\n                            return <div className={\n                                    event.name === \"toolUse\"? \"event-tool\": \n                                    event.interrupted === true?\"event-int\":\n                                    event.type === \"in\"?\"event-in\":\"event-out\"\n                                } \n                                key={event.key}\n                                onClick={() => {\n                                    this.setState({selectedEvent: event, showEventJson: true});\n                                }}\n                                >\n                                <Icon name={event.type === \"in\"? \"arrow-down\": \"arrow-up\"} />&nbsp;&nbsp;\n                                {event.name}\n                                {event.events.length > 1? ` (${event.events.length})`: \"\"}\n                                <div className=\"tooltip\">\n                                    <pre id=\"jsonDisplay\">{event.events.map(e=>{\n                                        return JSON.stringify(e,null,2);\n                                    })\n                                }</pre>\n                                </div>\n                            </div>\n                        })}\n                        <Modal\n                            onDismiss={() => this.setState({showEventJson: false})}\n                            visible={this.state.showEventJson}\n                            header=\"Event details\"\n                            size='medium'\n                            footer={\n                                <Box float=\"right\">\n                                <SpaceBetween direction=\"horizontal\" size=\"xs\">\n                                    <Button variant=\"link\" onClick={() => this.setState({showEventJson: false})}>Close</Button>\n                                </SpaceBetween>\n                                </Box>\n                            }\n                        >\n                            <div className='eventdetail'>\n                            <pre id=\"jsonDisplay\">\n                                {this.state.selectedEvent && this.state.selectedEvent.events.map(e=>{\n                                    const eventType = Object.keys(e?.event)[0];\n                                    if (eventType === \"audioInput\" || eventType === \"audioOutput\")\n                                        e.event[eventType].content = e.event[eventType].content.substr(0,10) + \"...\";\n                                    const ts = new Date(e.timestamp).toLocaleString(undefined, {\n                                        year: \"numeric\",\n                                        month: \"2-digit\",\n                                        day: \"2-digit\",\n                                        hour: \"2-digit\",\n                                        minute: \"2-digit\",\n                                        second: \"2-digit\",\n                                        fractionalSecondDigits: 3, // Show milliseconds\n                                        hour12: false // 24-hour format\n                                    });\n                                    var displayJson = { ...e };\n                                    delete displayJson.timestamp;\n                                    return ts + \"\\n\" + JSON.stringify(displayJson,null,2) + \"\\n\";\n                                })}\n                            </pre>\n                            </div>\n                        </Modal>\n                        <Modal\n                            onDismiss={() => this.setState({showConfig: false})}\n                            visible={this.state.showConfig}\n                            header=\"Nova S2S settings\"\n                            size='large'\n                            footer={\n                                <Box float=\"right\">\n                                <SpaceBetween direction=\"horizontal\" size=\"xs\">\n                                    <Button variant=\"link\" onClick={() => this.setState({showConfig: false})}>Save</Button>\n                                </SpaceBetween>\n                                </Box>\n                            }\n                        >\n                            <div className='config'>\n                                <FormField\n                                    label=\"Voice Id\"\n                                    stretch={true}\n                                >\n                                    <Select\n                                        selectedOption={this.state.configVoiceIdOption}\n                                        onChange={({ detail }) =>\n                                            this.setState({configVoiceIdOption: detail.selectedOption})\n                                        }\n                                        options={[\n                                            { label: \"Matthew (en-US)\", value: \"matthew\" },\n                                            { label: \"Tiffany (en-US)\", value: \"tiffany\" },\n                                            { label: \"Amy (en-GB)\", value: \"amy\" },\n                                        ]}\n                                        />\n                                </FormField>\n                                <br/>\n                                <FormField\n                                    label=\"System prompt\"\n                                    description=\"For the speech model\"\n                                    stretch={true}\n                                >\n                                    <Textarea\n                                        onChange={({ detail }) => this.setState({configSystemPrompt: detail.value})}\n                                        value={this.state.configSystemPrompt}\n                                        placeholder=\"Speech system prompt\"\n                                    />\n                                </FormField>\n                                <br/>\n                                <FormField\n                                    label=\"Tool use configuration\"\n                                    description=\"For external integration such as RAG and Agents\"\n                                    stretch={true}\n                                >\n                                    <Textarea\n                                        onChange={({ detail }) => this.setState({configToolUse: detail.value})}\n                                        value={this.state.configToolUse}\n                                        rows={10}\n                                        placeholder=\"{}\"\n                                    />\n                                </FormField>\n                                        <br/>\n                                <FormField\n                                    label=\"Chat history\"\n                                    description=\"Sample chat history to resume conversation\"\n                                    stretch={true}\n                                >\n                                    <Textarea\n                                        onChange={({ detail }) => this.setState({configChatHistory: detail.value})}\n                                        value={this.state.configChatHistory}\n                                        rows={15}\n                                        placeholder=\"{}\"\n                                    />\n                                </FormField>\n                            </div>\n                        </Modal>\n                    </div>\n                    </ExpandableSection>\n                    </Container>\n                </ColumnLayout>\n            </div>\n        );\n    }\n}\n\nexport default S2sChatBot;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}